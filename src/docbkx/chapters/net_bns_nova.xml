<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE section [
        <!-- Some useful entities borrowed from HTML -->
        <!ENTITY ndash  "&#x2013;">
        <!ENTITY mdash  "&#x2014;">
        <!ENTITY hellip "&#x2026;">
        <!-- Useful for describing APIs -->
        <!ENTITY GET    '<command xmlns="http://docbook.org/ns/docbook">GET</command>'>
        <!ENTITY PUT    '<command xmlns="http://docbook.org/ns/docbook">PUT</command>'>
        <!ENTITY POST   '<command xmlns="http://docbook.org/ns/docbook">POST</command>'>
        <!ENTITY DELETE '<command xmlns="http://docbook.org/ns/docbook">DELETE</command>'>
        <!ENTITY CIS 'Rackspace Cloud Identity Service'>
<!ENTITY fgCS 'first generation Cloud Servers'>
<!ENTITY ngCS 'next generation Cloud Servers'>
<!ENTITY cnresource1 'rax-networks'>
<!ENTITY virt_ext 'Cloud Networks virtual interface extension'>
<!ENTITY cnresource2 'os-networksv2'>
]>
<section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude"
    xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:raxm="http://docs.rackspace.com/api/metadata" version="5.0"
    xml:id="boot_server_nova">
    <title>Nova-network: Provision a server with an isolated network</title>
    <para>These examples, using the nova-network API, walk you through the steps to boot a new server, attaching the network
        directly to the server, and to list your servers.</para>
    <para>The exercises also help you learn about cURL commands and the Cloud Networks nova-network API. </para>
    
    <section xml:id="create_server_with_network">
        <title>Provision a server with an isolated network</title>
        <para>To create your new server and attach an isolated network, you need the following information: </para>
        
        <itemizedlist>
            <listitem>
                <para>The name of the new server. Use a name of your choice.</para>
            </listitem>
            <listitem>
                <para>The image ID. For how to list images, see
                    <link xlink:href="http://docs.rackspace.com/servers/api/v2/cs-gettingstarted/content/list_images.html">
                    List Images</link>.</para>
            </listitem>
            <listitem>
                <para>The flavor ID. For how to list flavors, see
                    <link xlink:href="http://docs.rackspace.com/servers/api/v2/cs-gettingstarted/content/list_flavors.html">
                    List Flavors</link>.</para>
            </listitem>
            <listitem>
                <para>The network ID of your isolated network. This is the ID you copied in <olink targetdoc="cn-gettingstarted"
                    targetptr="create_network">“Step 1. Create an Isolated Network”</olink></para>
            </listitem>
        </itemizedlist>
        
        <para>You specify these values as parameters in a nova command or as attributes in the request body in a cURL
            command.</para>
        <note security="external">
            <para xmlns:svg="http://www.w3.org/2000/svg" xmlns:m="http://www.w3.org/1998/Math/MathML"
                xmlns:html="http://www.w3.org/1999/xhtml">You cannot attach an isolated network to an existing server. However,
                to work around this limitation, you can create an image of the server and build a new server based on that image.
                When you build the new server, you can attach the isolated network. For information, see
                <link xlink:href="http://www.rackspace.com/knowledge_center/article/attach-an-existing-cloud-server-to-a-cloud-network">
                <citetitle>Attach a Cloud Network to an Existing Cloud Server</citetitle></link>.
                To use the create image API, see
                <link xlink:href="http://docs.rackspace.com/servers/api/v2/cs-devguide/content/Create_Image-d1e4655.html">
                Create Image</link>.</para>
        </note>
        <note>
            <para xmlns:svg="http://www.w3.org/2000/svg" xmlns:m="http://www.w3.org/1998/Math/MathML"
                xmlns:html="http://www.w3.org/1999/xhtml">You can use the &virt_ext; to attach an isolated network to an existing
                server. For information, see <olink targetdoc="cn-gettingstarted" targetptr="ch_gs_attach_network_to_server"
                    >Attach Your Network to an Existing Server</olink>.</para>
        </note>
        <sidebar>
            <para><emphasis role="bold">Next step:</emphasis> Choose one of the following methods:<itemizedlist>
                <listitem>
                    <para><olink targetdoc="cn-gettingstarted" targetptr="nova_provision_server">“Provision a server with an
                        isolated network with the nova client”</olink></para>
                </listitem>
                <listitem>
                    <para><olink targetdoc="cn-gettingstarted" targetptr="curl_provision_server">“Provision a server with an
                        isolated network with cURL”</olink></para>
                </listitem>
            </itemizedlist></para>
        </sidebar>
        
        <?hard-pagebreak?>
        <section xml:id="nova_provision_server">
            <title>Provision a server with an isolated network with the nova client</title>
            <para>
                <procedure>
                    <title>To provision a server and attach an isolated network</title>
                    <step>
                        <para>Issue the following nova client command:
                            <programlisting language="bash" role="gutter: false"><?db-font-size 50%?>
                            <prompt>$</prompt> nova boot my_server_with_network --flavor 2 --image d42f821e-c2d1-4796-9f07-af5ed7912d0e --nic net-id=e65accc0-1d98-45eb-af76-ab3d31edc7d2</programlisting></para>
                        <?sbr?>
                        <para><emphasis role="bold">Output:</emphasis> The command returns information about the new server, as
                            shown in the following output:</para>
                        <informalexample>
                            <screen><computeroutput>
+-------------------------+--------------------------------------+
| Property                | Value                                |
+-------------------------+--------------------------------------+
| OS-DCF:diskConfig       | AUTO                                 |
| OS-EXT-STS:power_state  | 0                                    |
| OS-EXT-STS:task_state   | scheduling                           |
| OS-EXT-STS:vm_state     | building                             |
| accessIPv4              |                                      |
| accessIPv6              |                                      |
| adminPass               | abababababab                         |
| created                 | 2012-10-04T18:07:56Z                 |
| flavor                  | 512MB Standard Instance              |
| hostId                  |                                      |
| id                      | 72859427-1e74-4a4f-b6b5-f547c1c3d452 |
| image                   | Fedora 17 (Beefy Miracle)            |
| metadata                | {}                                   |
| name                    | my_server_with_network               |
| progress                | 0                                    |
| status                  | BUILD                                |
| tenant_id               | 010101                               |
| updated                 | 2012-10-04T18:07:56Z                 |
| user_id                 | 170454                               |
+-------------------------+--------------------------------------+</computeroutput></screen>
                        </informalexample>
                        
                    </step>
                </procedure>
            </para>
            <sidebar>
                <para><emphasis role="bold">Next step:</emphasis>
                    <olink targetdoc="cn-gettingstarted" targetptr="list_servers">“List servers and attached
                        networks”</olink></para>
            </sidebar>
        </section>
        <?hard-pagebreak?>
        <section xml:id="curl_provision_server">
            <title>Provision a server with an isolated network with cURL</title>
            <section xml:id="json_create_server">
                <title>JSON request and response</title>
                <procedure>
                    <title>To provision a server with an isolated network to the server</title>
                    <step>
                        <para>Issue the following cURL
                            command:<programlisting language="bash" role="gutter: false"><?db-font-size 55%?>
                            <prompt>$</prompt> curl https://dfw.servers.api.rackspacecloud.com/v2/$account/servers \
         -X POST \
         -H "X-Auth-Project-Id: $account" \
         -H "Content-Type: application/json" \
         -H "Accept: application/json" \
         -H "X-Auth-Token: $token" \
         -d '{"server": {"name": "my_server_with_network", "imageRef": "d42f821e-c2d1-4796-9f07-af5ed7912d0e", "flavorRef": "2", "max_count": 1, "min_count": 1, "networks": [{"uuid": "538a112a-34d1-47ff-bf1e-c40639e886e2"}, {"uuid": "00000000-0000-0000-0000-000000000000"}, {"uuid": "11111111-1111-1111-1111-111111111111"}]}}' \
         | python -m json.tool</programlisting></para>
                        <para>In addition to the isolated network, PublicNet and ServiceNet are attached to the server. You must
                            explicitly specify these networks to attach them to your server.</para>
                        <para><emphasis role="bold">Output:</emphasis> The API operation returns information about the new
                            server, as shown in the following output:</para>
                        <programlisting language="json"><?db-font-size 65%?>
                        <xi:include href="../../common/samples/server-post-resp.json" parse="text"/></programlisting>
                    </step>
                </procedure>
                <sidebar>
                    <para><emphasis role="bold">Next step:</emphasis>
                        <olink targetdoc="cn-gettingstarted" targetptr="list_servers">“List servers and attached
                            networks”</olink></para>
                </sidebar>
            </section>
            <section xml:id="xml_create_server">
                <title>XML request and response</title>
                <procedure>
                    <title>To provision a server and attach an isolated network to the server</title>
                    <step>
                        <para>Issue the following cURL
                            command:<programlisting language="bash" role="gutter: false"><?db-font-size 55%?>
                            <prompt>$</prompt> curl -i https://dfw.servers.api.rackspacecloud.com/v2/$account/servers.xml \
        -X POST \
        -H "X-Auth-Project-Id: $account" \
        -H "Content-Type: application/xml" \
        -H "Accept: application/xml" \
        -H "X-Auth-Token: $token" \
        -d '&lt;?xml version="1.0" encoding="UTF-8"?>&lt;server xmlns="http://docs.openstack.org/compute/api/v1.1" imageRef="3afe97b2-26dc-49c5-a2cc-a2fc8d80c001" flavorRef="2" name="api-test-server-xml2">&lt;metadata>&lt;meta key="My Server Name">API Test Server XML&lt;/meta>&lt;/metadata>&lt;networks>&lt;uuid>0ef47ac7-6797-4e01-8a47-ed26ec3aaa56&lt;/uuid>&lt;uuid>00000000-0000-0000-0000-000000000000&lt;/uuid>&lt;uuid>11111111-1111-1111-1111-111111111111&lt;/uuid>&lt;/networks>&lt;/server>'</programlisting></para>
                        <para>In addition to the isolated network, PublicNet and ServiceNet are attached to the server. You must
                            explicitly specify these networks to attach them to your server.</para>
                        <para><emphasis role="bold">Output:</emphasis> The API operation returns information about the new
                            server, as shown in the following output:</para>
                        <programlisting language="xml"><?db-font-size 65%?><xi:include href="../../common/samples/server-post-resp.xml" parse="text"/></programlisting>
                    </step>
                </procedure>
                <sidebar>
                    <para><emphasis role="bold">Next step:</emphasis>
                        <olink targetdoc="cn-gettingstarted" targetptr="list_servers">“List servers and attached
                            networks”</olink></para>
                </sidebar>
            </section>
        </section>
        <?hard-pagebreak?>
    </section>
    <section xml:id="list_servers">
        <title>List servers and attached networks</title>
        <para>To show all the servers in your Cloud account, you can list servers. When you list servers, the addresses for any
            attached networks are displayed. The networks include any isolated networks that you have created and Rackspace
            public and private networks.</para>
        <sidebar>
            <para><emphasis role="bold">Next step:</emphasis> Choose one of the following methods:<itemizedlist>
                <listitem>
                    <para><olink targetdoc="cn-gettingstarted" targetptr="nova_list_servers">“List servers with the nova
                        client”</olink></para>
                </listitem>
                <listitem>
                    <para><olink targetdoc="cn-gettingstarted" targetptr="curl_list_servers">“List servers with
                        cURL”</olink></para>
                </listitem>
            </itemizedlist></para>
        </sidebar>
        <?hard-pagebreak?>
        <section xml:id="nova_list_servers">
            <title>List servers with the nova client</title>
            <procedure>
                <title>To list servers with the nova client:</title>
                <step>
                    <para>Issue the following command:</para>
                    <programlisting language="bash" role="gutter: false"><prompt>$</prompt> nova list</programlisting>
                    <para>For each server, the command returns the server ID, name, status, and addresses for any attached
                        networks, as shown in the following output:</para>
                    
                    <programlisting language="bash" role="gutter: false"><?db-font-size 40%?>+--------------------------------------+----------------+--------+---------------------------------------------------------------------------------------+
| ID                                   | Name           | Status | Networks                                                                              |
+--------------------------------------+----------------+--------+---------------------------------------------------------------------------------------+
| 9da98125-0de8-4b84-880c-b42977c32773 | myUbuntuServer | ACTIVE | public=2001:4800:780d:0509:d87b:9cbc:ff04:488b, 198.101.231.59; private=10.179.224.74 |
| a09e7493-7429-41e1-8d3f-384d7ece09c0 | UbuntuDevStack | ACTIVE | public=2001:4800:780e:0510:d87b:9cbc:ff04:3e81, 50.56.186.185; private=10.180.13.75   |
+--------------------------------------+----------------+--------+---------------------------------------------------------------------------------------+</programlisting>
                    <para>The networks include any isolated networks that you have created and Rackspace public and private
                        networks.</para>
                </step>
                <step>
                    <para>Look for your server in the list of servers. Servers are listed by server ID. </para>
                    <para>Copy the server ID for your server. To update or delete your server, you need this ID.</para>
                    <para>You use the public IP address when you log into your server.</para>
                </step>
            </procedure>
            <sidebar>
                <para><emphasis role="bold">Next step: </emphasis><olink targetdoc="cn-gettingstarted"
                    targetptr="ch_gs_attach_network_to_server">Attach your network to an existing server</olink></para>
            </sidebar>
        </section>
        <?hard-pagebreak?>
        <section xml:id="curl_list_servers">
            <title>List servers with cURL</title>
            <procedure>
                <title>To list servers with cURL:</title>
                <step>
                    <para>Issue the following command:</para>
                    <programlisting language="bash" role="gutter: false"><?db-font-size 60%?>
                    <prompt>$</prompt> curl -s https://dfw.servers.api.rackspacecloud.com/v2/$account/servers/detail \
       -H "X-Auth-Token: $token" | python -m json.tool</programlisting>
                    <para>For each server, the command returns the disk configuration, the addresses of any attached networks,
                        flavor and image information, the server ID, and the server status. The networks include any isolated
                        networks that you have created and Rackspace public and private networks.</para>
                    <para>The following output shows the list servers information, including information for the Ubuntu server
                        that you just created:</para>
                    <programlisting language="json"><?db-font-size 60%?>{
    "servers": [
        {
            "OS-DCF:diskConfig": "AUTO", 
            "OS-EXT-STS:power_state": 0, 
            "OS-EXT-STS:task_state": "spawning", 
            "OS-EXT-STS:vm_state": "building", 
            "accessIPv4": "", 
            "accessIPv6": "", 
            "addresses": {
                "private": [
                    {
                        "addr": "10.180.16.21", 
                        "version": 4
                    }
                ], 
                "public": [
                    {
                        "addr": "2001:4800:780e:0510:d87b:9cbc:ff04:4bac", 
                        "version": 6
                    }, 
                    {
                        "addr": "198.101.242.47", 
                        "version": 4
                    }
                ]
            }, 
            "created": "2012-08-16T17:11:43Z", 
            "flavor": {
                "id": "6", 
                "links": [
                    {
                        "href": "https://dfw.servers.api.rackspacecloud.com/010101/flavors/6", 
                        "rel": "bookmark"
                    }
                ]
            }, 
            "hostId": "692f611d2d84e5368b5995d7733ca5f175dc670eda91eded50a47eab", 
            "id": "1a861bf7-2a5e-40a4-acb3-1fb058cf2a74", 
            "image": {
                "id": "3afe97b2-26dc-49c5-a2cc-a2fc8d80c001", 
                "links": [
                    {
                        "href": "https://dfw.servers.api.rackspacecloud.com/010101/images/3afe97b2-26dc-49c5-a2cc-a2fc8d80c001", 
                        "rel": "bookmark"
                    }
                ]
            }, 
            "links": [
                {
                    "href": "https://dfw.servers.api.rackspacecloud.com/v2/010101/servers/1a861bf7-2a5e-40a4-acb3-1fb058cf2a74", 
                    "rel": "self"
                }, 
                {
                    "href": "https://dfw.servers.api.rackspacecloud.com/010101/servers/1a861bf7-2a5e-40a4-acb3-1fb058cf2a74", 
                    "rel": "bookmark"
                }
            ], 
            "metadata": {
                "My Server Name": "Ubuntu 11.10 server"
            }, 
            "name": "myUbuntuServer", 
            "progress": 75,  
            "status": "BUILD", 
            "tenant_id": "010101", 
            "updated": "2012-08-16T17:14:50Z", 
            "user_id": "170454"
        }, 
        {
            "OS-DCF:diskConfig": "AUTO", 
            "OS-EXT-STS:power_state": 1, 
            "OS-EXT-STS:task_state": null, 
            "OS-EXT-STS:vm_state": "active", 
            "accessIPv4": "", 
            "accessIPv6": "", 
            "addresses": {
                "private": [
                    {
                        "addr": "10.180.13.75", 
                        "version": 4
                    }
                ], 
                "public": [
                    {
                        "addr": "2001:4800:780e:0510:d87b:9cbc:ff04:3e81", 
                        "version": 6
                    }, 
                    {
                        "addr": "50.56.186.185", 
                        "version": 4
                    }
                ]
            }, 
            "created": "2012-05-15T15:47:37Z", 
            "flavor": {
                "id": "6", 
                "links": [
                    {
                        "href": "https://dfw.servers.api.rackspacecloud.com/010101/flavors/6", 
                        "rel": "bookmark"
                    }
                ]
            }, 
            "hostId": "1d65b563fc573c2eb544319e0af598f2b2c5f84f75de252db3757cd3", 
            "id": "a09e7493-7429-41e1-8d3f-384d7ece09c0", 
            "image": {
                "id": "3afe97b2-26dc-49c5-a2cc-a2fc8d80c001", 
                "links": [
                    {
                        "href": "https://dfw.servers.api.rackspacecloud.com/010101/images/3afe97b2-26dc-49c5-a2cc-a2fc8d80c001", 
                        "rel": "bookmark"
                    }
                ]
            }, 
            "links": [
                {
                    "href": "https://dfw.servers.api.rackspacecloud.com/v2/010101/servers/a09e7493-7429-41e1-8d3f-384d7ece09c0", 
                    "rel": "self"
                }, 
                {
                    "href": "https://dfw.servers.api.rackspacecloud.com/010101/servers/a09e7493-7429-41e1-8d3f-384d7ece09c0", 
                    "rel": "bookmark"
                }
            ], 
            "metadata": {}, 
            "name": "UbuntuDevStack", 
            "progress": 100, 
            "status": "ACTIVE", 
            "tenant_id": "010101", 
            "updated": "2012-05-15T15:55:00Z", 
            "user_id": "170454"
        }
    ]
}</programlisting>
                </step>
                <step>
                    <para>Look for your server in the list of servers. Servers are listed by server ID. </para>
                    <para>Copy the server ID for your server. To update or delete your server, you need this ID.</para>
                    <para>You use the public IP address when you log into your server.</para>
                </step>
            </procedure>
            <sidebar>
                <para><emphasis role="bold">Next step: </emphasis><olink targetdoc="cn-gettingstarted"
                    targetptr="ch_gs_attach_network_to_server">Attach your network to an existing server</olink></para>
            </sidebar>
        </section>
    </section>
</section>
